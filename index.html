<!-- Buttons unterhalb des bestehenden Formulars -->
<div class="field">
  <button type="button" id="testReportBtn">Test Report</button>
  <button type="button" id="fullReportBtn">Full Report</button>
  <button type="button" id="fillAgainBtn">Fill out again</button>
</div>

<script>
  // Eindeutige ID generieren, falls noch nicht vorhanden
  function generateId() {
    return 'id-' + Math.random().toString(36).substr(2, 9);
  }

  // Prüfen, dass alle Pflichtfelder ausgefüllt sind
  function validateForm() {
    const fields = ['country','age_group','sex','height','weight','smoking','alcohol','activity','life_expectancy'];
    for (let f of fields) {
      if (!document.getElementById(f).value.trim()) {
        alert('Bitte alle Pflichtfelder ausfüllen');
        return false;
      }
    }
    return true;
  }

  // Formulardaten lokal speichern
  function saveFormData() {
    const formData = {
      id: localStorage.getItem('formId') || generateId(),
      Email: document.getElementById('email').value,
      Country: document.getElementById('country').value,
      Age_group: document.getElementById('age_group').value,
      Sex: document.getElementById('sex').value,
      Height_cm: Number(document.getElementById('height').value),
      Weight_kg: Number(document.getElementById('weight').value),
      Smoking: Number(document.getElementById('smoking').value),
      Alcohol: Number(document.getElementById('alcohol').value),
      Physical_Activity: Number(document.getElementById('activity').value),
      Healthy_Life_Expectancy: Number(document.getElementById('life_expectancy').value)
    };
    localStorage.setItem('formData', JSON.stringify(formData));
    localStorage.setItem('formId', formData.id);
    return formData;
  }

  // Gespeicherte Daten beim Laden wieder einfügen
  window.addEventListener('load', () => {
    const saved = JSON.parse(localStorage.getItem('formData'));
    if (saved) {
      for (let key in saved) {
        if (document.getElementById(key)) {
          document.getElementById(key).value = saved[key];
        }
      }
    }
  });

  // Test Report → nur lokal
  document.getElementById('testReportBtn').addEventListener('click', () => {
    if (!validateForm()) return;
    saveFormData();
    alert('Test Report lokal gespeichert. Sie können ihn sofort einsehen.');
  });

  // Full Report → lokal speichern und zur Payment-Seite weiterleiten
  document.getElementById('fullReportBtn').addEventListener('click', () => {
    if (!validateForm()) return;
    const data = saveFormData();
    window.location.href = '/payment.html?id=' + data.id;
  });

  // Fill out again → Formular zurücksetzen
  document.getElementById('fillAgainBtn').addEventListener('click', () => {
    localStorage.removeItem('formData');
    localStorage.removeItem('formId');
    document.getElementById('health-form').reset();
  });
</script>